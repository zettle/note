# 单测场景

## 1、单测emit事件

比如有组件`Hello.vue`

```vue
<template>
    <div>
        <button @click="onClick">点击</button>
    </div>
</template>

<script lang="ts" setup>
const emit = defineEmits<{
    'sure': [payload: string, age: number];
}>();

function onClick () {
    emit('sure', 'xiaoming', 23)
}
</script>
```

现在测试emit事件是否正常，代码如下：

```ts
const wrapper = mount(Hello);
const closeButton = wrapper.find("button");
await closeButton.trigger("click"); // 需要加上await，等promise处理
expect(wrapper.emitted()).toHaveProperty("sure");
expect(wrapper.emitted().sure).toBeTruthy();
expect(wrapper.emitted().sure[0]).toEqual(['xiaoming']);
```

`emitted()` 返回一个对象，有所有事件，格式：`{ sure: [ [ 'xiaoming', 23 ] ], click: [ [ [MouseEvent] ] ] }`

从上面格式可以看到，key是事件名，值是二维数组，emit出来的具体数据就放在其中。

## 2、测试transition的钩子

因为单测中是没有css的，也就没有动画效果，因此钩子函数无法测试，我们可以通过主动调用来测试

将钩子函数抽离到单独的一个ts文件中

```ts
// transitionEvents.ts  各个动画钩子
const _setHeightZero = (el: HTMLElement) => (el.style.height = '0px')
const _setHeightScroll = (el: HTMLElement) => (el.style.height = `${el.scrollHeight}px`)
const _setHeightEmpty = (el: HTMLElement) => (el.style.height = '')
const _setOverflowHidden = (el: HTMLElement) => (el.style.overflow = 'hidden')
const _setOverflowEmpty = (el: HTMLElement) => (el.style.overflow = '')

const transitionEvents: Record<string, (el: HTMLDivElement) => void> = {
  beforeEnter(el) {
    _setHeightZero(el)
    _setOverflowHidden(el)
  },
  enter(el) {
    _setHeightScroll(el)
  },
  // ...
}
```

然后在vue中通过 `v-on` 进行绑定

```vue
<script setup lang="ts">
import transitionEvents from './transitionEvents'
</script>

<template>
  <transition name="slide" v-on="transitionEvents">
  	<div></div>
  </transition>
</template>
```

那么在单测的时候，其实我们只需要测 `transitionEvents.ts` 里面函数逻辑对不对即可，至于 `el` 我们可以造一个 `<div></div>` 来测试

```ts
// transitionEvents.spec.tsx
describe('transitionEvents', () => {
  const wrapper = mount(() => (<div>随意</div>))
  it('beforeEnter', () => {
    transitionEvents.beforeEnter(wrapper.element) // 主动调用函数
    expect(wrapper.element.style.height).toBe('0px') // 断言修改之后的样式是否正确
    expect(wrapper.element.style.overflow).toBe('hidden')
  })
})
```

## 3、测试install方法

比如在组件库中，我们常常会将组件挂载多一个install方法，以此试下 `app.use()` 的方式调用。