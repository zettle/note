# 基础入门

vitest完全兼容jest，会jest入门vitest非常快

安装: `pnpm i -D vitest`

比如现在 `sum.ts` 和 `sum.spec.ts` 内容如下

```ts
// sum.ts
export function sum(a: number, b: number) {
  return a + b
}

// sum.spec.ts
import { expect, test } from 'vitest'
import { sum } from './sum'

test('adds 1 + 2 to equal 3', () => {
  expect(sum(1, 2)).toBe(3)
});
```

执行 `vitest` 即可查看运行结果，并且会启动watch模式。

执行 `vitest run` 只运行一次单测。

执行 `vitest run --coverage`可以生成覆盖率报告。



## vue组件单测

vitest天然支持vue组件，在测试vue组件之前我们需要配置`vite.config.ts`

```ts
import { defineConfig } from 'vite';
import Vue from '@vitejs/plugin-vue';

export default defineConfig({
  plugins: [Vue()]
});
```

比如现在有下面的`Hello.vue`组件

```vue
<template>
    <div>{{msg}}</div>
</template>

<script lang="ts" setup>
const msg = ref('hello');
</script>
```

和对应单测文件 `hello.spec.ts`

```ts
import { test } from 'vitest';
import Hello from './hello.vue';

test('测试Hello', () => {
  console.log(Hello);
})
```

再次执行`vitest run`跑单测，如果遇到下面提示，说文件不存在，是我们没有安装vue依赖，执行下`pnpm i vue`之后即可

```text
 FAIL  src/components/hello.spec.ts [ src/components/hello.spec.ts ]
Error: Failed to load url vue (resolved id: vue) in E:/workspace/vitest-learn/src/components/hello.vue. Does the file exist?
```

## 配置文件抽离（推荐）

可以抽离成 `vite.config.ts` 和 `vitest.config.ts`	

修改 `vitest.config.ts` 文件如下：

```ts
import { mergeConfig, defineConfig, configDefaults } from 'vitest/config'
import viteConfig from './vite.config'

export default mergeConfig(
  viteConfig,
  defineConfig({
    test: {
    },
  }),
)
```

## 配置文件不抽离

直接在`vite.config.ts` 加关于vitest的配置

```ts
/// <reference types="vitest/config" />
import { defineConfig } from "vite";
import vue from "@vitejs/plugin-vue";

export default defineConfig({
    plugins: [vue()],
    test: {
        // ...
    },
});
```

加上 `<reference types="vitest/config" />` 之后就能得到test的提示